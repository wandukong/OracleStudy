# 병렬처리
- 프로세스를 여러 개 사용하여, 실행 시간을 극적으로 단축시킬 수 있다.
- PARALLEL(테이블명 갯수) 힌트 사용
- 힌트를 이용해 수동으로 지정해야 병렬처리가 가능하다.
- 병렬로 수행하는 것은 파티션이 되어 있을 때 더 좋은 성과를 낸다.
- 단일 테이블에서 병렬 수행 효과가 생각보다 낮고, 인덱스 이용이 무조건 좋은 것은 아니다.

## 🕹병렬도
- 병렬 힌트를 사용할 때, 옵티마이저가 스캔 방식을 인덱스 스캔으로 결정하면 병렬 힌트를 사용하지 않는다.
	- FULL(OI) 힌트 사용
- PARALLEL 힌트를 사용할 때는 병렬로 읽을 테이블과 병렬도(개수)를 지정한다.
	- 항상 지정된 개수의 프로세스가 생기는 것이 아니라, 지정한 병렬도의 2배수가 생성되는 경우도 있다.
	- 4개의 프로세스를 생성하여 2개는 임의로 나눠진 데이터를 A~M, N~Z로 분배하고, 이를 받은 2개의 프로세스는 각각 받은 데이터를 정렬한 다음 데이터를 합치는 작업을 한다.
```sql
SELECT /* FULL(OI) PARALLEL(OI 2)
       COUNT(*)
FROM ORD_ITEM OI
WHERE ORD_DT BETWEEN '20120101' AND '20120331'
```

## 🔫데이터 재분배
```
각각의 프로세스가 더 효율적으로 처리할 수 있도록 할당 받은 데이터를 다시 분배하는 일
```
- 병렬 프로세스는 데이터를 처리할 때, 각각의 프로세스는 데이터를 공유하지 못한다.
- GROUP BY, ORDER BY 에서 데이터 재분배가 일어난다.
- 실행계획에서 P->P 연산이 발생하면, 프로세스는 두배로 생성되고, 프로세스간 통신은 제곱 만큼 발생한다.
- P->S 연산으로 먼저 처리된 순서대로 결과 집합이 만들어진다. 
	- GROUP BY: QC(RAND)
	- ORDERY BY: QC(ORDER)

## 📸병렬 해시 조인과 파티션 와이즈 조인
- 병렬 프로세스로 조인을 수행할 때, 가장 많이 사용하는 조인 방식은 **해시 조인**이다.
	- 병렬로 테이블을 읽을 때, 테이블 풀 스캔을 진행하고, 풀 스캔으로 읽은 대용량의 데이터를 **인덱스 없이** NL조인을 수행하거나, 소트머지 조인을 위해 대용량의 데이터를 **조인키로 정렬**하기가 버겁기 때문이다.
- **파티션 와이즈 조인** : 각 프로세스가 조인을 위해 데이터 쌍을 만드는 작업 
<hr/>

### 풀 파티션 와이즈 조인 
```
파티션끼리 조인이 되는 것
```
- 두 테이블 모두 파티션 키 컬럼이 참여할 경우, 데이터 재분배가 일어나지 않는다.
	- 조인해야 할 파티션끼리 짝지어 주면 서로 다른 프로세스의 데이터는 조인의 가능성이 없기 때문
- 이를 병렬로 수행한 경우, 데이터 재분배 과정 없이 조인이 가능하다.
- 만약 옵티마이저가 다른 판단을 하게 된다면 PQ_DISTRIBUTE 힌트를 사용한다.
	- ```PQ_DISTRIBUTE(INNER테이블, OUTTR테이블분배방식, INNER테이블분배방식) ```
	- ```분배 방식 종류: NONE, PARTITION, HASH, BROADCAST```
	- PQ_DISTRIBUTE(B, HASH, HASH): INNER테이블은 B이고, 두 테이블 모두 해시 방식으로 분해
	- PQ_DISTRIBUTE(B, PARTITION, NONE): INNER테이블은 B이고, A 테이블 분해 방식을 B 테이블 파티션으로 나눈 방식과 동일하게 분배
 
 **서브 파티션으로 해시 파티션을 추가 할 경우**
 - 이미 해시 파티션이 있으므로, **해시 조인 시 필요한 PGA 공간이 많이 필요하지 않기 때문에** PGA 사용량이 다른 SQL문에 비해 현저히 낮아진다.


**하나만 파티션된 테이블에서의 조인인 경우**
- 파티션 테이블과 조인 시 데이터 재분배가 일어나지 않으려면 파티션 키 컬럼(서브 파티션 키 X)이 조인에 참여해야 한다.
	- 이미 파티션된 테이블과 조인하는 경우를 **부분 파티션 와이즈 조인**이라고 한다.
		- PQ_DISTTRIBUTE(OI PARTITION NONE)
	- 조인을 프로세스별로 따로 진행하기 때문에 논리적으로 서로 다른 프로세스에 조인 가능성이 있는 데이터가 있으면 안된다.

**두 테이블 모두 파티션이 아닌 경우**
